<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script src="js/vendor/underscore-min.js"></script>
        <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.1.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->



    <div id="store-locator-admin">
        <div class="title">
            <h1>StoreLocator Admin</h1>
        </div>


        <div class="content">
        </div>
    </div>



    <!-- templates -->
    <script type="text/template"  id="brand-template">
        <form id="pick-brand">
            <label>Brands:</label>
            <select id="brand-dropdown">
                <% for (var i in brands) { %>
                    <li>
                        <option value="<%= brands[i].id %>"><%= brands[i].get('name') %></option>
                    </li>
                <% } %>
            </select>
            <button type="submit">Go</button>
        </form>
    </script>

    <script type="text/template"  id="venue-template">
        <form id="save-venue">
            <input value="<%= brand %>" name="<%= brand %>" type="hidden">
            <% for (var i in venues) { %>
                <input name="<%= venues[i].get('name') %>" value="<%= venues[i].id %>" type="checkbox"><%= venues[i].get('name') %>
            <% } %>
            <button type="submit">save</button>
        </form>
    </script>


    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>


    <script type="text/javascript">


    Parse.$ = jQuery;

    Parse.initialize("EE1v8eLeCMeQmXAQKjcg2fvjLR2OoO8AzYY3KQfx", "o9B99wDktfYCBWAFQVwhpVBhCswLKQ14vE2rBDuO");
    

    //Models
    var Venue = Parse.Object.extend("Venue");
    var Brand = Parse.Object.extend("Brand");



    var brand_query = new Parse.Query(Brand);
    brand_query.find({
      success: function(brands) {
        var brand_template_compiled = _.template($('#brand-template').html(),{brands:brands});
        $(".content").html(brand_template_compiled);
        $("#pick-brand").submit(function(){

            var brand_id = $('#brand-dropdown').find(":selected").val();

            var venue_query = new Parse.Query(Venue);

            venue_query.find({
              success: function(venues) {

                var venue_template_compiled = _.template($('#venue-template').html(),{venues:venues,brand:brand_id});

                $("#save-venue").remove();
                $(".content").append(venue_template_compiled);

              },
              error: function(object, error) {
                console.log("something weird happened");
              }
            });
            return false;
        });

      },
      error: function(object, error) {
        console.log("something weird happened");
      }
    });

  </script>
    </body>
</html>
